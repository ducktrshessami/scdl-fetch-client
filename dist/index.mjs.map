{"version":3,"sources":["../src/error.ts","../src/fetch.ts","../src/test.ts"],"sourcesContent":["export class ClientFetchError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = \"ClientFetchError\";\n    }\n}\n","import { ClientFetchError } from \"./error\";\n\nfunction matchLast(str: string, pattern: RegExp): RegExpMatchArray | null {\n    let current: RegExpMatchArray | null;\n    let last: RegExpMatchArray | null = null;\n    do {\n        current = pattern.exec(str);\n        if (current) {\n            last = current;\n        }\n    }\n    while (current);\n    return last;\n}\n\nexport async function fetchClientID(): Promise<string> {\n    const initial = await fetch(\"https://soundcloud.com/\");\n    if (!initial.ok) {\n        throw new ClientFetchError(`Initial request failed: ${initial.status} ${initial.statusText}`);\n    }\n    const initialBody = await initial.text();\n    const results = matchLast(initialBody, /<script\\s+crossorigin\\s+src=[\"'](https?:\\/\\/[^\"']+)[\"']><\\/script>/gi);\n    if (!results) {\n        throw new ClientFetchError(\"Failed to parse script URL\");\n    }\n    const script = await fetch(results[1]);\n    if (!script.ok) {\n        throw new ClientFetchError(`Script request failed: ${script.status} ${script.statusText}`);\n    }\n    const scriptBody = await script.text();\n    const result = scriptBody.match(/\\bclient_id:\\s*[\"']([^\"']+)[\"']/i);\n    if (!result) {\n        throw new ClientFetchError(`Failed to parse client ID from script`);\n    }\n    return result[1];\n}\n","export async function testClientID(clientID: string): Promise<boolean> {\n    const { status } = await fetch(`https://api-v2.soundcloud.com/?client_id=${clientID}`, { method: \"HEAD\" });\n    return status === 404;\n}\n"],"mappings":"AAAO,IAAMA,EAAN,cAA+B,KAAM,CACxC,YAAYC,EAAiB,CACzB,MAAMA,CAAO,EACb,KAAK,KAAO,kBAChB,CACJ,ECHA,SAASC,EAAUC,EAAaC,EAA0C,CACtE,IAAIC,EACAC,EAAgC,KACpC,GACID,EAAUD,EAAQ,KAAKD,CAAG,EACtBE,IACAC,EAAOD,SAGRA,GACP,OAAOC,CACX,CAEA,eAAsBC,GAAiC,CACnD,IAAMC,EAAU,MAAM,MAAM,yBAAyB,EACrD,GAAI,CAACA,EAAQ,GACT,MAAM,IAAIC,EAAiB,2BAA2BD,EAAQ,MAAM,IAAIA,EAAQ,UAAU,EAAE,EAEhG,IAAME,EAAc,MAAMF,EAAQ,KAAK,EACjCG,EAAUT,EAAUQ,EAAa,sEAAsE,EAC7G,GAAI,CAACC,EACD,MAAM,IAAIF,EAAiB,4BAA4B,EAE3D,IAAMG,EAAS,MAAM,MAAMD,EAAQ,CAAC,CAAC,EACrC,GAAI,CAACC,EAAO,GACR,MAAM,IAAIH,EAAiB,0BAA0BG,EAAO,MAAM,IAAIA,EAAO,UAAU,EAAE,EAG7F,IAAMC,GADa,MAAMD,EAAO,KAAK,GACX,MAAM,kCAAkC,EAClE,GAAI,CAACC,EACD,MAAM,IAAIJ,EAAiB,uCAAuC,EAEtE,OAAOI,EAAO,CAAC,CACnB,CCnCA,eAAsBC,EAAaC,EAAoC,CACnE,GAAM,CAAE,OAAAC,CAAO,EAAI,MAAM,MAAM,4CAA4CD,CAAQ,GAAI,CAAE,OAAQ,MAAO,CAAC,EACzG,OAAOC,IAAW,GACtB","names":["ClientFetchError","message","matchLast","str","pattern","current","last","fetchClientID","initial","ClientFetchError","initialBody","results","script","result","testClientID","clientID","status"]}